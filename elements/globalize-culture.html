<link rel="import" href="../components/polymer/polymer.html">

<!-- <link rel="import" href="../components/globalize/lib/globalize.js"> -->
<script src="../components/globalize/lib/globalize.js"></script>

<polymer-element name="globalize-culture" attributes="culture">

<template>
  <style>
  :host {
    display: inline-block;
  }
  </style>
  <content></content>
  <select id="culturePicker">
    <option value="ar">العربية</option>
    <option value="en" selected>English</option>
    <option value="es">español</option>
    <option value="fr">français</option>
    <option value="it">italiano</option>
    <option value="ja">日本語</option>
    <option value="th">ไทย</option>
  </select>
</template>

<script>
Polymer( "globalize-culture", {

  culturePickerChanged: function() {
    var cultureIdentifier = this.$.culturePicker.value;
    this._loadCulture( cultureIdentifier, function() {
      this.culture = Globalize.cultures[ cultureIdentifier ];
    }.bind( this ));
  },

  cultureChanged: function() {
    this.dispatchEvent( new CustomEvent( "globalize-culture-changed" ) );
  },

  ready: function() {
    // TODO (12/5/2013): Figure out why Polymer declarative event binding can't wire this up.
    this.$.culturePicker.addEventListener( "change", function() {
      this.culturePickerChanged();
    }.bind( this ));
  },

  // Ensure the culture info for the given culture is loaded.
  _loadCulture: function( cultureIdentifier, callback ) {
    if ( Globalize.cultures[ cultureIdentifier] ) {
      // Already loaded.
      callback();
    } else {    
      // Dynamically load.
      var url = "../components/globalize/lib/cultures/globalize.culture." + cultureIdentifier + ".js";
      var script = document.createElement( "script" );
      script.addEventListener( "load", function() {
        callback();
      }.bind( this ));
      script.src = url;
      document.head.appendChild( script );
    }
  }

});
</script>

</polymer-element>